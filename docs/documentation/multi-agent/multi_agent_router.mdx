---
name: "MultiAgentRouter"
description: "Intelligent task dispatcher that distributes work based on agent capabilities and workload optimization"
---

**Swarm Type**: `MultiAgentRouter`

## Overview

The MultiAgentRouter acts as an intelligent task dispatcher, distributing work across agents based on their capabilities and current workload. This architecture analyzes incoming tasks and automatically routes them to the most suitable agents, optimizing both efficiency and quality of outcomes.

Key features:
- **Intelligent Routing**: Automatically assigns tasks to best-suited agents
- **Capability Matching**: Matches task requirements with agent specializations
- **Load Balancing**: Distributes workload efficiently across available agents
- **Dynamic Assignment**: Adapts routing based on agent performance and availability

## Use Cases

- Customer service request routing
- Content categorization and processing
- Technical support ticket assignment
- Multi-domain question answering

## API Usage

### Basic MultiAgentRouter Example

<Tabs>
<Tab title="Shell (curl)">
```bash
curl -X POST "https://api.swarms.world/v1/swarm/completions" \
  -H "x-api-key: $SWARMS_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Customer Support Router",
    "description": "Route customer inquiries to specialized support agents",
    "swarm_type": "MultiAgentRouter",
    "task": "Handle multiple customer inquiries: 1) Billing question about overcharge, 2) Technical issue with mobile app login, 3) Product recommendation for enterprise client, 4) Return policy question",
    "agents": [
      {
        "agent_name": "Billing Specialist",
        "description": "Handles billing, payments, and account issues",
        "system_prompt": "You are a billing specialist. Handle all billing inquiries, payment issues, refunds, and account-related questions with empathy and accuracy.",
        "model_name": "gpt-4o",
        "max_loops": 1,
        "temperature": 0.3
      },
      {
        "agent_name": "Technical Support",
        "description": "Resolves technical issues and troubleshooting",
        "system_prompt": "You are a technical support specialist. Diagnose and resolve technical issues, provide step-by-step troubleshooting, and escalate complex problems.",
        "model_name": "gpt-4o",
        "max_loops": 1,
        "temperature": 0.2
      },
      {
        "agent_name": "Sales Consultant",
        "description": "Provides product recommendations and sales support",
        "system_prompt": "You are a sales consultant. Provide product recommendations, explain features and benefits, and help customers find the right solutions.",
        "model_name": "gpt-4o",
        "max_loops": 1,
        "temperature": 0.4
      },
      {
        "agent_name": "Policy Advisor",
        "description": "Explains company policies and procedures",
        "system_prompt": "You are a policy advisor. Explain company policies, terms of service, return procedures, and compliance requirements clearly.",
        "model_name": "gpt-4o",
        "max_loops": 1,
        "temperature": 0.1
      }
    ],
    "max_loops": 1
  }'
```
</Tab>

<Tab title="Python (requests)">
```python
import requests
import json

API_BASE_URL = "https://api.swarms.world"
API_KEY = "your_api_key_here"

headers = {
    "x-api-key": API_KEY,
    "Content-Type": "application/json"
}

swarm_config = {
    "name": "Customer Support Router",
    "description": "Route customer inquiries to specialized support agents",
    "swarm_type": "MultiAgentRouter",
    "task": "Handle multiple customer inquiries: 1) Billing question about overcharge, 2) Technical issue with mobile app login, 3) Product recommendation for enterprise client, 4) Return policy question",
    "agents": [
        {
            "agent_name": "Billing Specialist",
            "description": "Handles billing, payments, and account issues",
            "system_prompt": "You are a billing specialist. Handle all billing inquiries, payment issues, refunds, and account-related questions with empathy and accuracy.",
            "model_name": "gpt-4o",
            "max_loops": 1,
            "temperature": 0.3
        },
        {
            "agent_name": "Technical Support",
            "description": "Resolves technical issues and troubleshooting",
            "system_prompt": "You are a technical support specialist. Diagnose and resolve technical issues, provide step-by-step troubleshooting, and escalate complex problems.",
            "model_name": "gpt-4o",
            "max_loops": 1,
            "temperature": 0.2
        },
        {
            "agent_name": "Sales Consultant",
            "description": "Provides product recommendations and sales support",
            "system_prompt": "You are a sales consultant. Provide product recommendations, explain features and benefits, and help customers find the right solutions.",
            "model_name": "gpt-4o",
            "max_loops": 1,
            "temperature": 0.4
        },
        {
            "agent_name": "Policy Advisor",
            "description": "Explains company policies and procedures",
            "system_prompt": "You are a policy advisor. Explain company policies, terms of service, return procedures, and compliance requirements clearly.",
            "model_name": "gpt-4o",
            "max_loops": 1,
            "temperature": 0.1
        }
    ],
    "max_loops": 1
}

response = requests.post(
    f"{API_BASE_URL}/v1/swarm/completions",
    headers=headers,
    json=swarm_config
)

if response.status_code == 200:
    result = response.json()
    print("MultiAgentRouter swarm completed successfully!")
    print(f"Cost: ${result['metadata']['billing_info']['total_cost']}")
    print(f"Execution time: {result['metadata']['execution_time_seconds']} seconds")
    print(f"Routed results: {result['output']}")
else:
    print(f"Error: {response.status_code} - {response.text}")
```
</Tab>

<Tab title="JavaScript (fetch)">
```javascript
const API_BASE_URL = "https://api.swarms.world";
const API_KEY = "your_api_key_here";

const headers = {
    "x-api-key": API_KEY,
    "Content-Type": "application/json"
};

const swarmConfig = {
    name: "Customer Support Router",
    description: "Route customer inquiries to specialized support agents",
    swarm_type: "MultiAgentRouter",
    task: "Handle multiple customer inquiries: 1) Billing question about overcharge, 2) Technical issue with mobile app login, 3) Product recommendation for enterprise client, 4) Return policy question",
    agents: [
        {
            agent_name: "Billing Specialist",
            description: "Handles billing, payments, and account issues",
            system_prompt: "You are a billing specialist. Handle all billing inquiries, payment issues, refunds, and account-related questions with empathy and accuracy.",
            model_name: "gpt-4o",
            max_loops: 1,
            temperature: 0.3
        },
        {
            agent_name: "Technical Support",
            description: "Resolves technical issues and troubleshooting",
            system_prompt: "You are a technical support specialist. Diagnose and resolve technical issues, provide step-by-step troubleshooting, and escalate complex problems.",
            model_name: "gpt-4o",
            max_loops: 1,
            temperature: 0.2
        },
        {
            agent_name: "Sales Consultant",
            description: "Provides product recommendations and sales support",
            system_prompt: "You are a sales consultant. Provide product recommendations, explain features and benefits, and help customers find the right solutions.",
            model_name: "gpt-4o",
            max_loops: 1,
            temperature: 0.4
        },
        {
            agent_name: "Policy Advisor",
            description: "Explains company policies and procedures",
            system_prompt: "You are a policy advisor. Explain company policies, terms of service, return procedures, and compliance requirements clearly.",
            model_name: "gpt-4o",
            max_loops: 1,
            temperature: 0.1
        }
    ],
    max_loops: 1
};

fetch(`${API_BASE_URL}/v1/swarm/completions`, {
    method: "POST",
    headers: headers,
    body: JSON.stringify(swarmConfig)
})
.then(response => response.json())
.then(result => {
    if (result.status === "success") {
        console.log("MultiAgentRouter swarm completed successfully!");
        console.log(`Cost: $${result.metadata.billing_info.total_cost}`);
        console.log(`Execution time: ${result.metadata.execution_time_seconds} seconds`);
        console.log("Routed results:", result.output);
    }
})
.catch(error => console.error("Error:", error));
```
</Tab>

<Tab title="Go">
```go
package main

import (
    "bytes"
    "encoding/json"
    "fmt"
    "io/ioutil"
    "net/http"
)

type Agent struct {
    AgentName    string  `json:"agent_name"`
    Description  string  `json:"description"`
    SystemPrompt string  `json:"system_prompt"`
    ModelName    string  `json:"model_name"`
    MaxLoops     int     `json:"max_loops"`
    Temperature  float64 `json:"temperature"`
}

type SwarmConfig struct {
    Name        string   `json:"name"`
    Description string   `json:"description"`
    SwarmType   string   `json:"swarm_type"`
    Task        string   `json:"task"`
    Agents      []Agent  `json:"agents"`
    MaxLoops    int      `json:"max_loops"`
}

func main() {
    API_BASE_URL := "https://api.swarms.world"
    API_KEY := "your_api_key_here"

    swarmConfig := SwarmConfig{
        Name:        "Customer Support Router",
        Description: "Route customer inquiries to specialized support agents",
        SwarmType:   "MultiAgentRouter",
        Task:        "Handle multiple customer inquiries: 1) Billing question about overcharge, 2) Technical issue with mobile app login, 3) Product recommendation for enterprise client, 4) Return policy question",
        Agents: []Agent{
            {
                AgentName:    "Billing Specialist",
                Description:  "Handles billing, payments, and account issues",
                SystemPrompt: "You are a billing specialist. Handle all billing inquiries, payment issues, refunds, and account-related questions with empathy and accuracy.",
                ModelName:    "gpt-4o",
                MaxLoops:     1,
                Temperature:  0.3,
            },
            {
                AgentName:    "Technical Support",
                Description:  "Resolves technical issues and troubleshooting",
                SystemPrompt: "You are a technical support specialist. Diagnose and resolve technical issues, provide step-by-step troubleshooting, and escalate complex problems.",
                ModelName:    "gpt-4o",
                MaxLoops:     1,
                Temperature:  0.2,
            },
            {
                AgentName:    "Sales Consultant",
                Description:  "Provides product recommendations and sales support",
                SystemPrompt: "You are a sales consultant. Provide product recommendations, explain features and benefits, and help customers find the right solutions.",
                ModelName:    "gpt-4o",
                MaxLoops:     1,
                Temperature:  0.4,
            },
            {
                AgentName:    "Policy Advisor",
                Description:  "Explains company policies and procedures",
                SystemPrompt: "You are a policy advisor. Explain company policies, terms of service, return procedures, and compliance requirements clearly.",
                ModelName:    "gpt-4o",
                MaxLoops:     1,
                Temperature:  0.1,
            },
        },
        MaxLoops: 1,
    }

    jsonData, _ := json.Marshal(swarmConfig)
    
    req, _ := http.NewRequest("POST", API_BASE_URL+"/v1/swarm/completions", bytes.NewBuffer(jsonData))
    req.Header.Set("x-api-key", API_KEY)
    req.Header.Set("Content-Type", "application/json")

    client := &http.Client{}
    resp, err := client.Do(req)
    if err != nil {
        fmt.Printf("Error: %v\n", err)
        return
    }
    defer resp.Body.Close()

    body, _ := ioutil.ReadAll(resp.Body)
    fmt.Printf("Response: %s\n", string(body))
}
```
</Tab>

<Tab title="Rust">
```rust
use reqwest::Client;
use serde_json::{json, Value};
use std::error::Error;

#[tokio::main]
async fn main() -> Result<(), Box<dyn Error>> {
    let api_base_url = "https://api.swarms.world";
    let api_key = "your_api_key_here";

    let swarm_config = json!({
        "name": "Customer Support Router",
        "description": "Route customer inquiries to specialized support agents",
        "swarm_type": "MultiAgentRouter",
        "task": "Handle multiple customer inquiries: 1) Billing question about overcharge, 2) Technical issue with mobile app login, 3) Product recommendation for enterprise client, 4) Return policy question",
        "agents": [
            {
                "agent_name": "Billing Specialist",
                "description": "Handles billing, payments, and account issues",
                "system_prompt": "You are a billing specialist. Handle all billing inquiries, payment issues, refunds, and account-related questions with empathy and accuracy.",
                "model_name": "gpt-4o",
                "max_loops": 1,
                "temperature": 0.3
            },
            {
                "agent_name": "Technical Support",
                "description": "Resolves technical issues and troubleshooting",
                "system_prompt": "You are a technical support specialist. Diagnose and resolve technical issues, provide step-by-step troubleshooting, and escalate complex problems.",
                "model_name": "gpt-4o",
                "max_loops": 1,
                "temperature": 0.2
            },
            {
                "agent_name": "Sales Consultant",
                "description": "Provides product recommendations and sales support",
                "system_prompt": "You are a sales consultant. Provide product recommendations, explain features and benefits, and help customers find the right solutions.",
                "model_name": "gpt-4o",
                "max_loops": 1,
                "temperature": 0.4
            },
            {
                "agent_name": "Policy Advisor",
                "description": "Explains company policies and procedures",
                "system_prompt": "You are a policy advisor. Explain company policies, terms of service, return procedures, and compliance requirements clearly.",
                "model_name": "gpt-4o",
                "max_loops": 1,
                "temperature": 0.1
            }
        ],
        "max_loops": 1
    });

    let client = Client::new();
    let response = client
        .post(&format!("{}/v1/swarm/completions", api_base_url))
        .header("x-api-key", api_key)
        .header("Content-Type", "application/json")
        .json(&swarm_config)
        .send()
        .await?;

    if response.status().is_success() {
        let result: Value = response.json().await?;
        println!("MultiAgentRouter swarm completed successfully!");
        println!("Response: {:?}", result);
    } else {
        println!("Error: {}", response.status());
    }

    Ok(())
}
```
</Tab>
</Tabs>

**Example Response**:
```json
{
    "job_id": "swarms-R17nZFDesmLHxCRoeyF3NVYvPaXk",
    "status": "success",
    "swarm_name": "Customer Support Router",
    "description": "Route customer inquiries to specialized support agents",
    "swarm_type": "MultiAgentRouter",
    "output": [
        {
            "role": "Billing Specialist",
            "content": "I'll handle the billing question about the overcharge. Let me review your account and explain the charges..."
        },
        {
            "role": "Technical Support",
            "content": "I'll help you resolve the mobile app login issue. Let's troubleshoot this step by step..."
        },
        {
            "role": "Sales Consultant",
            "content": "I'll provide product recommendations for your enterprise client. Based on their needs..."
        },
        {
            "role": "Policy Advisor",
            "content": "I'll explain our return policy clearly. Here are the key points you need to know..."
        }
    ],
    "number_of_agents": 4,
    "service_tier": "standard",
    "execution_time": 18.5,
    "usage": {
        "input_tokens": 45,
        "output_tokens": 2100,
        "total_tokens": 2145,
        "billing_info": {
            "cost_breakdown": {
                "agent_cost": 0.04,
                "input_token_cost": 0.000135,
                "output_token_cost": 0.0315,
                "token_counts": {
                    "total_input_tokens": 45,
                    "total_output_tokens": 2100,
                    "total_tokens": 2145
                },
                "num_agents": 4,
                "service_tier": "standard",
                "night_time_discount_applied": true
            },
            "total_cost": 0.071635,
            "discount_active": true,
            "discount_type": "night_time",
            "discount_percentage": 75
        }
    }
}
```

## Tutorial: Build an AI-Powered IT Helpdesk

In this tutorial, you'll build an intelligent IT helpdesk system that automatically routes support tickets to specialized agents. MultiAgentRouter analyzes incoming requests and dispatches them to the most qualified agent based on the issue type, reducing resolution time and improving support quality.

### What You'll Build

An automated IT support routing system with:
1. **Network Specialist** - Handles connectivity, VPN, and network issues
2. **Security Analyst** - Addresses security concerns, access requests, and incidents
3. **Software Support** - Resolves application issues and software installations
4. **Hardware Technician** - Manages device problems and equipment requests
5. **Account Administrator** - Handles password resets, permissions, and account issues

The router intelligently matches each ticket to the right specialist.

### Prerequisites

- Python 3.8+
- A Swarms API key ([get one here](https://swarms.world))
- `requests` library (`pip install requests`)

### Step 1: Set Up Your Environment

```python
import requests
import json
import os
from datetime import datetime
from enum import Enum
from typing import Optional

# Configuration
API_BASE_URL = "https://api.swarms.world"
API_KEY = os.environ.get("SWARMS_API_KEY", "your_api_key_here")

headers = {
    "x-api-key": API_KEY,
    "Content-Type": "application/json"
}
```

### Step 2: Define the Ticket Data Model

```python
class Priority(Enum):
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    CRITICAL = "critical"


class SupportTicket:
    """Represents an incoming IT support ticket."""

    def __init__(
        self,
        ticket_id: str,
        subject: str,
        description: str,
        user_email: str,
        priority: Priority = Priority.MEDIUM,
        user_department: Optional[str] = None,
        affected_systems: Optional[str] = None
    ):
        self.ticket_id = ticket_id
        self.subject = subject
        self.description = description
        self.user_email = user_email
        self.priority = priority
        self.user_department = user_department
        self.affected_systems = affected_systems
        self.created_at = datetime.now()

    def to_prompt(self) -> str:
        """Format ticket for the routing prompt."""
        return f"""
SUPPORT TICKET #{self.ticket_id}
================================
Subject: {self.subject}
Priority: {self.priority.value.upper()}
Submitted by: {self.user_email}
Department: {self.user_department or 'Not specified'}
Affected Systems: {self.affected_systems or 'Not specified'}
Created: {self.created_at.strftime('%Y-%m-%d %H:%M')}

DESCRIPTION:
{self.description}
"""
```

### Step 3: Create Specialized Support Agents

Each agent has a clear specialization. The router will match tickets to the most appropriate agent.

```python
def create_it_support_agents() -> list[dict]:
    """Create specialized IT support agents for the router."""

    return [
        {
            "agent_name": "Network Specialist",
            "description": "Handles network connectivity, VPN, WiFi, and infrastructure issues",
            "system_prompt": """You are a Network Support Specialist with expertise in:
- Network connectivity and troubleshooting
- VPN configuration and issues
- WiFi and wireless networking
- DNS and IP addressing
- Firewall and routing issues
- Network performance optimization

When responding to tickets:
1. Acknowledge the issue clearly
2. Ask targeted diagnostic questions if needed
3. Provide step-by-step troubleshooting instructions
4. Include commands the user can run (ping, ipconfig, etc.)
5. Escalate to on-site support if remote resolution isn't possible

Always explain technical concepts in user-friendly terms.
Include estimated resolution time when possible.""",
            "model_name": "gpt-4o",
            "max_loops": 1,
            "temperature": 0.3
        },
        {
            "agent_name": "Security Analyst",
            "description": "Addresses security incidents, access requests, and compliance issues",
            "system_prompt": """You are an IT Security Analyst with expertise in:
- Security incident response
- Access control and permissions
- Phishing and malware incidents
- Data protection and compliance
- Security policy enforcement
- Suspicious activity investigation

When responding to tickets:
1. Assess the severity and potential impact immediately
2. For active threats, provide immediate containment steps
3. Document all actions for audit trail
4. Follow security protocols strictly
5. Never share sensitive security details in responses

CRITICAL: For any potential data breach or active attack, flag for immediate
escalation and provide emergency containment instructions.

Include relevant security policies when explaining decisions.""",
            "model_name": "gpt-4o",
            "max_loops": 1,
            "temperature": 0.2  # Lower temperature for security precision
        },
        {
            "agent_name": "Software Support Specialist",
            "description": "Resolves application issues, software installations, and configuration",
            "system_prompt": """You are a Software Support Specialist with expertise in:
- Application troubleshooting (Office 365, Adobe, browsers, etc.)
- Software installation and updates
- License management
- Application configuration
- Integration issues between applications
- Performance optimization for software

When responding to tickets:
1. Identify the specific application and version
2. Check for known issues or recent updates
3. Provide clear, numbered steps for resolution
4. Include screenshots descriptions where helpful
5. Suggest preventive measures for future

Common solutions to mention:
- Clear cache and cookies
- Repair/reinstall application
- Check for updates
- Verify system requirements
- Review error logs""",
            "model_name": "gpt-4o",
            "max_loops": 1,
            "temperature": 0.3
        },
        {
            "agent_name": "Hardware Technician",
            "description": "Manages hardware issues, device problems, and equipment requests",
            "system_prompt": """You are a Hardware Support Technician with expertise in:
- Computer and laptop troubleshooting
- Peripheral devices (printers, monitors, keyboards)
- Hardware diagnostics
- Equipment provisioning and setup
- Warranty and repair coordination
- Asset management

When responding to tickets:
1. Identify the specific hardware and model
2. Determine if issue is hardware or software related
3. Provide safe diagnostic steps (no risk of data loss)
4. Assess if on-site visit is required
5. Check warranty status if applicable

For equipment requests:
- Verify approval requirements
- Provide expected delivery timelines
- Include setup instructions or schedule

SAFETY: Always warn about static electricity and proper handling.""",
            "model_name": "gpt-4o",
            "max_loops": 1,
            "temperature": 0.3
        },
        {
            "agent_name": "Account Administrator",
            "description": "Handles password resets, permissions, account provisioning, and access",
            "system_prompt": """You are an Account Administrator with expertise in:
- Password resets and account recovery
- User provisioning and deprovisioning
- Permission and access management
- Group membership management
- Multi-factor authentication (MFA) setup
- Single sign-on (SSO) issues

When responding to tickets:
1. Verify the request is legitimate (check requester authority)
2. For sensitive changes, confirm approval chain
3. Provide secure instructions (never send passwords in tickets)
4. Document all account changes made
5. Set appropriate expiration for temporary access

SECURITY PROTOCOLS:
- Never reset executive accounts without verification callback
- Require manager approval for elevated permissions
- Log all permission changes
- Enforce password complexity requirements

Include links to self-service portals when applicable.""",
            "model_name": "gpt-4o",
            "max_loops": 1,
            "temperature": 0.2  # Lower temperature for account security
        }
    ]
```

### Step 4: Build the Ticket Router

```python
def route_ticket(ticket: SupportTicket) -> dict:
    """
    Route a support ticket to the appropriate specialist.

    Args:
        ticket: The support ticket to route

    Returns:
        dict: API response with routed specialist response
    """

    swarm_config = {
        "name": f"IT Support: Ticket #{ticket.ticket_id}",
        "description": "Intelligent IT support ticket routing",
        "swarm_type": "MultiAgentRouter",
        "task": f"""Process this IT support ticket and provide a helpful response.

{ticket.to_prompt()}

Analyze the ticket and provide:
1. Your diagnosis of the issue
2. Step-by-step resolution instructions
3. Any additional information needed from the user
4. Estimated time to resolution
5. Preventive recommendations if applicable""",
        "agents": create_it_support_agents(),
        "max_loops": 1
    }

    response = requests.post(
        f"{API_BASE_URL}/v1/swarm/completions",
        headers=headers,
        json=swarm_config,
        timeout=60
    )

    if response.status_code == 200:
        return response.json()
    else:
        raise Exception(f"API Error: {response.status_code} - {response.text}")
```

### Step 5: Create the Response Formatter

```python
def format_support_response(result: dict, ticket: SupportTicket) -> str:
    """Format the routing result as a support response."""

    outputs = result.get("output", [])

    if not outputs:
        return "Error: No response generated"

    # Get the routed agent's response
    response = outputs[0]
    agent_name = response.get("role", "Support Agent")
    content = response.get("content", "No response content")

    # Build formatted response
    formatted = f"""
{'=' * 60}
TICKET #{ticket.ticket_id} - RESPONSE
{'=' * 60}

üìã Subject: {ticket.subject}
üéØ Routed to: {agent_name}
‚è±Ô∏è  Response time: {result.get('execution_time', 0):.1f}s
üìä Priority: {ticket.priority.value.upper()}

{'‚îÄ' * 60}
SPECIALIST RESPONSE
{'‚îÄ' * 60}

{content}

{'‚îÄ' * 60}
TICKET METADATA
{'‚îÄ' * 60}
Job ID: {result.get('job_id', 'N/A')}
Tokens used: {result.get('usage', {}).get('total_tokens', 0):,}
Cost: ${result.get('usage', {}).get('billing_info', {}).get('total_cost', 0):.4f}
{'=' * 60}
"""
    return formatted


def log_routing_decision(result: dict, ticket: SupportTicket):
    """Log the routing decision for analytics."""

    outputs = result.get("output", [])
    routed_to = outputs[0].get("role", "Unknown") if outputs else "None"

    log_entry = {
        "timestamp": datetime.now().isoformat(),
        "ticket_id": ticket.ticket_id,
        "subject": ticket.subject,
        "priority": ticket.priority.value,
        "routed_to": routed_to,
        "response_time": result.get("execution_time", 0),
        "job_id": result.get("job_id", ""),
    }

    print(f"üìù Routing Log: Ticket #{ticket.ticket_id} ‚Üí {routed_to}")
    return log_entry
```

### Step 6: Build the Helpdesk Interface

```python
def process_ticket_queue(tickets: list[SupportTicket]) -> list[dict]:
    """
    Process a queue of support tickets through the router.

    Args:
        tickets: List of tickets to process

    Returns:
        List of results for each ticket
    """

    results = []

    print(f"\nüé´ Processing {len(tickets)} tickets...\n")

    for i, ticket in enumerate(tickets, 1):
        print(f"[{i}/{len(tickets)}] Processing Ticket #{ticket.ticket_id}: {ticket.subject}")

        try:
            result = route_ticket(ticket)
            response = format_support_response(result, ticket)
            log_entry = log_routing_decision(result, ticket)

            results.append({
                "ticket": ticket,
                "result": result,
                "response": response,
                "log": log_entry,
                "success": True
            })

            print(f"    ‚úÖ Routed to: {log_entry['routed_to']}")

        except Exception as e:
            print(f"    ‚ùå Error: {e}")
            results.append({
                "ticket": ticket,
                "error": str(e),
                "success": False
            })

    return results


def main():
    """Run the IT Helpdesk demo with sample tickets."""

    # Sample tickets demonstrating different issue types
    sample_tickets = [
        SupportTicket(
            ticket_id="INC001234",
            subject="Cannot connect to VPN from home",
            description="""I've been trying to connect to the company VPN since this morning
            but keep getting "Connection timed out" error. I'm working from home and
            this is blocking all my work. I've tried restarting my computer and router.
            Using Windows 11 and the Cisco AnyConnect client.""",
            user_email="john.smith@company.com",
            priority=Priority.HIGH,
            user_department="Engineering",
            affected_systems="VPN, Remote Access"
        ),
        SupportTicket(
            ticket_id="INC001235",
            subject="Suspicious email received - possible phishing",
            description="""I received an email claiming to be from IT asking me to verify
            my password by clicking a link. The email address looks slightly off
            (it-support@company-secure.com instead of our domain). I haven't clicked
            anything yet. Should I be concerned? The email had our company logo.""",
            user_email="sarah.jones@company.com",
            priority=Priority.CRITICAL,
            user_department="Finance",
            affected_systems="Email"
        ),
        SupportTicket(
            ticket_id="INC001236",
            subject="Microsoft Excel keeps crashing",
            description="""Every time I try to open a specific Excel file, the application
            crashes. It's a large file with about 50 tabs and lots of formulas.
            Other Excel files work fine. I need this file urgently for the quarterly
            report due tomorrow. Running Office 365 on Windows 10.""",
            user_email="mike.wilson@company.com",
            priority=Priority.HIGH,
            user_department="Accounting",
            affected_systems="Microsoft Excel"
        ),
        SupportTicket(
            ticket_id="INC001237",
            subject="New laptop request for new hire",
            description="""We have a new senior developer starting next Monday (Jan 20).
            Need a MacBook Pro 16" with 32GB RAM provisioned and ready.
            Standard developer tools should be pre-installed.
            Manager approval: Jane Doe (attached)""",
            user_email="hr@company.com",
            priority=Priority.MEDIUM,
            user_department="HR",
            affected_systems="Hardware Provisioning"
        ),
        SupportTicket(
            ticket_id="INC001238",
            subject="Password reset needed - locked out of account",
            description="""I forgot my password over the weekend and now I'm completely
            locked out. I tried the self-service reset but it says my security
            questions are wrong (I think I set them up years ago). I have meetings
            starting in 30 minutes and can't access anything.""",
            user_email="emergency.user@company.com",
            priority=Priority.HIGH,
            user_department="Sales",
            affected_systems="Active Directory, All Systems"
        ),
    ]

    print("=" * 60)
    print("üñ•Ô∏è  AI-POWERED IT HELPDESK")
    print("   Intelligent Ticket Routing System")
    print("=" * 60)

    # Process all tickets
    results = process_ticket_queue(sample_tickets)

    # Summary
    successful = sum(1 for r in results if r.get('success'))
    print(f"\n{'=' * 60}")
    print("üìä PROCESSING SUMMARY")
    print(f"{'=' * 60}")
    print(f"   Total tickets: {len(results)}")
    print(f"   Successfully routed: {successful}")
    print(f"   Failed: {len(results) - successful}")

    # Show routing distribution
    routing_counts = {}
    for r in results:
        if r.get('success'):
            agent = r['log']['routed_to']
            routing_counts[agent] = routing_counts.get(agent, 0) + 1

    print(f"\n   Routing Distribution:")
    for agent, count in sorted(routing_counts.items()):
        print(f"   - {agent}: {count} ticket(s)")

    # Show one full response as example
    print(f"\n{'=' * 60}")
    print("üìÑ SAMPLE RESPONSE (First Ticket)")
    print(results[0]['response'] if results[0].get('success') else "Error occurred")

    return results


if __name__ == "__main__":
    main()
```

### Step 7: Add Routing Analytics

Track routing patterns for optimization:

```python
class RoutingAnalytics:
    """Track and analyze routing patterns."""

    def __init__(self):
        self.routing_history = []

    def record(self, log_entry: dict):
        """Record a routing decision."""
        self.routing_history.append(log_entry)

    def get_agent_stats(self) -> dict:
        """Get statistics by agent."""
        stats = {}
        for entry in self.routing_history:
            agent = entry.get('routed_to', 'Unknown')
            if agent not in stats:
                stats[agent] = {
                    'count': 0,
                    'total_response_time': 0,
                    'priorities': {'low': 0, 'medium': 0, 'high': 0, 'critical': 0}
                }
            stats[agent]['count'] += 1
            stats[agent]['total_response_time'] += entry.get('response_time', 0)
            priority = entry.get('priority', 'medium')
            stats[agent]['priorities'][priority] += 1

        # Calculate averages
        for agent in stats:
            if stats[agent]['count'] > 0:
                stats[agent]['avg_response_time'] = (
                    stats[agent]['total_response_time'] / stats[agent]['count']
                )

        return stats

    def print_report(self):
        """Print analytics report."""
        stats = self.get_agent_stats()

        print("\n" + "=" * 60)
        print("üìà ROUTING ANALYTICS REPORT")
        print("=" * 60)

        for agent, data in sorted(stats.items()):
            print(f"\n{agent}:")
            print(f"  Tickets handled: {data['count']}")
            print(f"  Avg response time: {data.get('avg_response_time', 0):.1f}s")
            print(f"  By priority: {data['priorities']}")


# Usage:
# analytics = RoutingAnalytics()
# for result in results:
#     if result.get('success'):
#         analytics.record(result['log'])
# analytics.print_report()
```

### Expected Output

```
============================================================
üñ•Ô∏è  AI-POWERED IT HELPDESK
   Intelligent Ticket Routing System
============================================================

üé´ Processing 5 tickets...

[1/5] Processing Ticket #INC001234: Cannot connect to VPN from home
    ‚úÖ Routed to: Network Specialist
[2/5] Processing Ticket #INC001235: Suspicious email received - possible phishing
    ‚úÖ Routed to: Security Analyst
[3/5] Processing Ticket #INC001236: Microsoft Excel keeps crashing
    ‚úÖ Routed to: Software Support Specialist
[4/5] Processing Ticket #INC001237: New laptop request for new hire
    ‚úÖ Routed to: Hardware Technician
[5/5] Processing Ticket #INC001238: Password reset needed - locked out of account
    ‚úÖ Routed to: Account Administrator

============================================================
üìä PROCESSING SUMMARY
============================================================
   Total tickets: 5
   Successfully routed: 5
   Failed: 0

   Routing Distribution:
   - Account Administrator: 1 ticket(s)
   - Hardware Technician: 1 ticket(s)
   - Network Specialist: 1 ticket(s)
   - Security Analyst: 1 ticket(s)
   - Software Support Specialist: 1 ticket(s)

============================================================
üìÑ SAMPLE RESPONSE (First Ticket)
============================================================
TICKET #INC001234 - RESPONSE
============================================================

üìã Subject: Cannot connect to VPN from home
üéØ Routed to: Network Specialist
‚è±Ô∏è  Response time: 12.3s
üìä Priority: HIGH

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
SPECIALIST RESPONSE
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

Hello John,

I understand you're unable to connect to the VPN and this is blocking your
work. Let's troubleshoot this systematically.

**Immediate Diagnostic Steps:**

1. First, verify your internet connection:
   - Open Command Prompt and run: `ping 8.8.8.8`
   - If this fails, the issue is with your home internet

2. Test DNS resolution:
   - Run: `nslookup vpn.company.com`
   - This should return our VPN server IP

3. Check Cisco AnyConnect:
   - Right-click the AnyConnect icon in system tray
   - Select "Statistics" to check connection attempts
   - Look for specific error codes

...
```

### Key Takeaways

1. **Clear Agent Specializations**: Each agent has a distinct domain. The router matches tickets based on agent descriptions and capabilities.

2. **Description is Critical**: The `description` field helps the router understand what each agent handles. Be specific and comprehensive.

3. **Priority Handling**: Include priority in your ticket structure so urgent issues can be flagged appropriately.

4. **Audit Trail**: Log all routing decisions for analytics and continuous improvement.

5. **Graceful Fallback**: Design a default handler for tickets that don't clearly match any specialist.

### MultiAgentRouter vs. Other Architectures

| Use MultiAgentRouter When | Don't Use When |
|--------------------------|----------------|
| Tasks need single expert handling | Multiple perspectives needed (use MixtureOfAgents) |
| Clear categorization is possible | Tasks must be done in sequence (use SequentialWorkflow) |
| Efficiency is priority | All tasks are independent (use ConcurrentWorkflow) |
| Routing logic is capability-based | Tasks are identical across agents |

## Best Practices

- Design agents with clear, distinct specializations
- Use for tasks that can be categorized and routed
- Ensure agents have complementary capabilities
- Ideal for customer service and support workflows

